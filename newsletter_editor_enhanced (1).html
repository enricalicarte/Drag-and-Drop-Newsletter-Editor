<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor de Newsletters - Drag & Drop</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            display: flex;
            height: 100vh;
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            box-shadow: 0 0 50px rgba(0,0,0,0.2);
        }

        /* Sidebar de elementos */
        .sidebar {
            width: 300px;
            background: #2d3748;
            color: white;
            padding: 20px;
            overflow-y: auto;
            border-right: 3px solid #4a5568;
        }

        .sidebar h2 {
            margin-bottom: 20px;
            color: #ffd700;
            font-size: 18px;
            font-weight: bold;
        }

        .element-group {
            margin-bottom: 25px;
        }

        .element-group h3 {
            color: #a0aec0;
            font-size: 14px;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .element {
            background: #4a5568;
            padding: 12px;
            margin-bottom: 8px;
            cursor: grab;
            border-radius: 6px;
            transition: all 0.3s ease;
            border-left: 4px solid #ffd700;
            user-select: none;
            font-size: 13px;
        }

        .element:hover {
            background: #5a6578;
            transform: translateX(5px);
        }

        .element:active {
            cursor: grabbing;
        }

        /* √Årea de dise√±o */
        .canvas-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #f7fafc;
        }

        .toolbar {
            background: white;
            padding: 15px 20px;
            border-bottom: 2px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .toolbar h1 {
            color: #2d3748;
            font-size: 24px;
            font-weight: bold;
        }

        .toolbar-buttons {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .btn-primary {
            background: #4299e1;
            color: white;
        }

        .btn-primary:hover {
            background: #3182ce;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #48bb78;
            color: white;
        }

        .btn-success:hover {
            background: #38a169;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #718096;
            color: white;
        }

        .btn-secondary:hover {
            background: #4a5568;
        }

        /* Canvas */
        .canvas {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            justify-content: center;
        }

        .email-preview {
            width: 650px;
            background: white;
            min-height: 800px;
            border-radius: 8px;
            overflow: visible;
            position: relative;
        }

        /* Elementos editables */
        .editable-element {
            position: relative;
            border: 2px dashed transparent;
            transition: all 0.3s ease;
            margin: 2px 0;
        }

        .editable-element:hover {
            border-color: #4299e1;
        }

        .editable-element.selected {
            border-color: #ffd700;
            background: rgba(255, 215, 0, 0.1);
        }

        .element-controls {
            position: absolute;
            top: -35px;
            right: 5px;
            background: #2d3748;
            padding: 5px;
            border-radius: 4px;
            display: none;
            z-index: 1000;
        }

        .editable-element.selected .element-controls {
            display: block;
        }

        .control-btn {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 5px;
            margin: 0 2px;
            border-radius: 3px;
            font-size: 12px;
        }

        .control-btn:hover {
            background: #4a5568;
        }

        /* Drop zones */
        .drop-zone {
            min-height: 60px;
            border: 2px dashed #cbd5e0;
            margin: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #a0aec0;
            font-size: 14px;
            transition: all 0.3s ease;
            border-radius: 6px;
            background: rgba(255,255,255,0.5);
        }

        .drop-zone.drag-over {
            border-color: #4299e1;
            background: rgba(66, 153, 225, 0.1);
            color: #4299e1;
            transform: scale(1.02);
        }

        /* Modal de configuraci√≥n */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 2000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 8px;
            width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal h3 {
            margin-bottom: 20px;
            color: #2d3748;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #4a5568;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 4px;
            font-size: 14px;
        }

        .form-group textarea {
            height: 120px;
            resize: vertical;
        }

        /* Color picker styles */
        .form-group .color-picker {
            display: flex;
            align-items: center;
        }

        .form-group .color-preview {
            width: 40px;
            height: 40px;
            border-radius: 4px;
            margin-right: 10px;
            border: 1px solid #e2e8f0;
        }

        /* Pesta√±as para la configuraci√≥n */
        .tab-container {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #e2e8f0;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            font-weight: bold;
            border-bottom: 3px solid transparent;
        }

        .tab.active {
            border-bottom: 3px solid #4299e1;
            color: #4299e1;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .sidebar {
                width: 280px;
            }
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
                height: auto;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
                max-height: 300px;
            }
            
            .email-preview {
                width: 100%;
                margin: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar de elementos -->
        <div class="sidebar">
            <h2>üìß Editor de Newsletter</h2>
            
            <div class="element-group">
                <h3>üìã Estructura Base</h3>
                <div class="element" data-element="preheader">
                    üìÑ Preheader
                </div>
                <div class="element" data-element="header">
                    üè† Header con Logo
                </div>
                <div class="element" data-element="banner-main">
                    üñºÔ∏è Banner Principal
                </div>
                <div class="element" data-element="title-intro">
                    üìù T√≠tulo + Introducci√≥n
                </div>
                <div class="element" data-element="divider">
                    ‚ûñ Separador
                </div>
            </div>

            <div class="element-group">
                <h3>üéµ Contenido</h3>
                <div class="element" data-element="three-photos">
                    üì∑ 3 Fotos en Fila
                </div>
                <div class="element" data-element="section-title">
                    üì¢ T√≠tulo de Secci√≥n
                </div>
                <div class="element" data-element="text-content">
                    üìÑ Contenido de Texto
                </div>
                <div class="element" data-element="two-columns">
                    üñºÔ∏è 2 Columnas
                </div>
                <div class="element" data-element="event-details">
                    üìÖ Detalles de Evento
                </div>
            </div>

            <div class="element-group">
                <h3>üéØ Especiales</h3>
                <div class="element" data-element="cta-section">
                    üìò Secci√≥n CTA
                </div>
                <div class="element" data-element="info-practica">
                    ‚ÑπÔ∏è Info Pr√°ctica
                </div>
                <div class="element" data-element="footer-advanced">
                    üëã Footer Avanzado
                </div>
                <div class="element" data-element="social-media">
                    üåê Redes Sociales
                </div>
            </div>
        </div>

        <!-- √Årea de dise√±o -->
        <div class="canvas-area">
            <!-- Toolbar -->
            <div class="toolbar">
                <h1>Newsletter Editor</h1>
                <div class="toolbar-buttons">
                    <button class="btn btn-secondary" onclick="clearCanvas()">üóëÔ∏è Limpiar</button>
                    <button class="btn btn-primary" onclick="previewNewsletter()">üëÅÔ∏è Vista Previa</button>
                    <button class="btn btn-success" onclick="downloadHTML()">‚¨áÔ∏è Descargar HTML</button>
                </div>
            </div>

            <!-- Canvas -->
            <div class="canvas">
                <div class="email-preview" id="emailPreview">
                    <div class="drop-zone" data-drop="true">
                        Arrastra elementos aqu√≠ para construir tu newsletter
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de configuraci√≥n -->
    <div class="modal" id="configModal">
        <div class="modal-content">
            <h3>‚öôÔ∏è Configurar Elemento</h3>
            <form id="configForm">
                <div class="tab-container" id="configTabs">
                    <div class="tab active" data-tab="content">Contenido</div>
                    <div class="tab" data-tab="design">Dise√±o</div>
                    <div class="tab" data-tab="spacing">Espaciado</div>
                </div>
                
                <div id="configFields"></div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="button" class="btn btn-success" onclick="saveElementConfig()">üíæ Guardar</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">‚ùå Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let draggedElement = null;
        let selectedElement = null;
        let currentEditingElement = null;

        // Funci√≥n auxiliar para a√±adir campos de padding y tipograf√≠a
        function addCommonFields(config) {
            return [
                ...config,
                // Campos de padding
                { name: 'paddingTop', label: 'Padding superior (px)', type: 'number', default: '20', section: 'spacing' },
                { name: 'paddingRight', label: 'Padding derecho (px)', type: 'number', default: '30', section: 'spacing' },
                { name: 'paddingBottom', label: 'Padding inferior (px)', type: 'number', default: '20', section: 'spacing' },
                { name: 'paddingLeft', label: 'Padding izquierdo (px)', type: 'number', default: '30', section: 'spacing' },
                // Campos de tipograf√≠a (solo para elementos con texto)
                ...(config.some(field => ['content', 'title', 'text'].some(textField => field.name.includes(textField))) ? [
                    { name: 'fontFamily', label: 'Familia de fuente', type: 'select', 
                      options: ['Helvetica Neue', 'Arial', 'Georgia', 'Times New Roman', 'Courier New', 'Verdana'], 
                      default: 'Helvetica Neue', section: 'design' },
                    { name: 'lineHeight', label: 'Altura de l√≠nea', type: 'number', default: '1.6', step: '0.1', section: 'design' },
                    { name: 'letterSpacing', label: 'Espaciado de letras (px)', type: 'number', default: '0', section: 'design' }
                ] : [])
            ];
        }

        // Configuraciones para cada tipo de elemento
        const elementConfigs = {
            preheader: addCommonFields([
                { name: 'previewText', label: 'Texto de vista previa', type: 'text', default: 'Vista previa del email', section: 'content' },
                { name: 'linkText', label: 'Texto del enlace', type: 'text', default: 'Ver en navegador', section: 'content' },
                { name: 'bgColor', label: 'Color de fondo', type: 'color', default: '#ffffff', section: 'design' },
                { name: 'textColor', label: 'Color de texto', type: 'color', default: '#656565', section: 'design' },
                { name: 'fontSize', label: 'Tama√±o de texto (px)', type: 'number', default: '12', section: 'design' }
            ]),
            header: addCommonFields([
                { name: 'logoUrl', label: 'URL del Logo', type: 'url', default: 'https://via.placeholder.com/180x60?text=LOGO', section: 'content' },
                { name: 'logoWidth', label: 'Ancho del logo (px o %)', type: 'text', default: '180px', section: 'design' },
                { name: 'logoHeight', label: 'Alto del logo (px o auto)', type: 'text', default: 'auto', section: 'design' },
                { name: 'logoAlignment', label: 'Alineaci√≥n', type: 'select', options: ['izquierda', 'centro', 'derecha'], default: 'centro', section: 'design' },
                { name: 'bgColor', label: 'Color de fondo', type: 'color', default: '#ffffff', section: 'design' }
            ]),
            'banner-main': addCommonFields([
                { name: 'imageUrl', label: 'URL del Banner', type: 'url', default: 'https://via.placeholder.com/600x300?text=BANNER', section: 'content' },
                { name: 'altText', label: 'Texto alternativo', type: 'text', default: 'Banner', section: 'content' },
                { name: 'linkUrl', label: 'URL del enlace (opcional)', type: 'url', default: '', section: 'content' },
                { name: 'bgColor', label: 'Color de fondo', type: 'color', default: '#ffffff', section: 'design' }
            ]),
            'title-intro': addCommonFields([
                { name: 'title', label: 'T√≠tulo', type: 'text', default: 'T√≠tulo Principal', section: 'content' },
                { name: 'content', label: 'Contenido', type: 'textarea', default: 'Contenido de introducci√≥n...', section: 'content' },
                { name: 'titleColor', label: 'Color del t√≠tulo', type: 'color', default: '#202020', section: 'design' },
                { name: 'textColor', label: 'Color del texto', type: 'color', default: '#202020', section: 'design' },
                { name: 'bgColor', label: 'Color de fondo', type: 'color', default: '#ffffff', section: 'design' },
                { name: 'titleFontSize', label: 'Tama√±o t√≠tulo (px)', type: 'number', default: '26', section: 'design' },
                { name: 'fontSize', label: 'Tama√±o de texto (px)', type: 'number', default: '18', section: 'design' },
                { name: 'titleFontWeight', label: 'Peso del t√≠tulo', type: 'select', options: ['normal', 'bold', '300', '400', '600', '700'], default: 'bold', section: 'design' }
            ]),
            'section-title': addCommonFields([
                { name: 'title', label: 'T√≠tulo', type: 'text', default: 'NUEVA SECCI√ìN', section: 'content' },
                { name: 'titleColor', label: 'Color del t√≠tulo', type: 'color', default: '#202020', section: 'design' },
                { name: 'bgColor', label: 'Color de fondo', type: 'color', default: '#ffffff', section: 'design' },
                { name: 'fontSize', label: 'Tama√±o de texto (px)', type: 'number', default: '28', section: 'design' },
                { name: 'fontWeight', label: 'Peso de fuente', type: 'select', options: ['normal', 'bold', '300', '400', '600', '700'], default: 'bold', section: 'design' },
                { name: 'textAlign', label: 'Alineaci√≥n', type: 'select', options: ['left', 'center', 'right'], default: 'left', section: 'design' }
            ]),
            'text-content': addCommonFields([
                { name: 'content', label: 'Contenido', type: 'textarea', default: 'Escribe aqu√≠ el contenido...', section: 'content' },
                { name: 'textColor', label: 'Color del texto', type: 'color', default: '#202020', section: 'design' },
                { name: 'bgColor', label: 'Color de fondo', type: 'color', default: '#ffffff', section: 'design' },
                { name: 'fontSize', label: 'Tama√±o de texto (px)', type: 'number', default: '16', section: 'design' },
                { name: 'textAlign', label: 'Alineaci√≥n', type: 'select', options: ['left', 'center', 'right', 'justify'], default: 'left', section: 'design' }
            ]),
            'three-photos': addCommonFields([
                { name: 'image1Url', label: 'URL Imagen 1', type: 'url', default: 'https://via.placeholder.com/200x150?text=1', section: 'content' },
                { name: 'image1Text', label: 'Texto 1', type: 'text', default: 'IMAGEN 1', section: 'content' },
                { name: 'image1Link', label: 'Enlace 1 (opcional)', type: 'url', default: '', section: 'content' },
                { name: 'image2Url', label: 'URL Imagen 2', type: 'url', default: 'https://via.placeholder.com/200x150?text=2', section: 'content' },
                { name: 'image2Text', label: 'Texto 2', type: 'text', default: 'IMAGEN 2', section: 'content' },
                { name: 'image2Link', label: 'Enlace 2 (opcional)', type: 'url', default: '', section: 'content' },
                { name: 'image3Url', label: 'URL Imagen 3', type: 'url', default: 'https://via.placeholder.com/200x150?text=3', section: 'content' },
                { name: 'image3Text', label: 'Texto 3', type: 'text', default: 'IMAGEN 3', section: 'content' },
                { name: 'image3Link', label: 'Enlace 3 (opcional)', type: 'url', default: '', section: 'content' },
                { name: 'textColor', label: 'Color del texto', type: 'color', default: '#202020', section: 'design' },
                { name: 'bgColor', label: 'Color de fondo', type: 'color', default: '#ffffff', section: 'design' },
                { name: 'fontSize', label: 'Tama√±o de texto (px)', type: 'number', default: '14', section: 'design' }
            ]),
            'two-columns': addCommonFields([
                { name: 'leftTitle', label: 'T√≠tulo columna izquierda', type: 'text', default: '', section: 'content' },
                { name: 'leftTitleSize', label: 'Tama√±o t√≠tulo izquierda (px)', type: 'number', default: '20', section: 'design' },
                { name: 'leftShowImage', label: 'Mostrar imagen izquierda', type: 'checkbox', default: false, section: 'content' },
                { name: 'leftImageUrl', label: 'URL imagen izquierda', type: 'url', default: 'https://via.placeholder.com/300x200?text=IMAGEN', section: 'content' },
                { name: 'leftImageAlt', label: 'Texto alt imagen izquierda', type: 'text', default: 'Imagen izquierda', section: 'content' },
                { name: 'leftImageLink', label: 'Enlace imagen izquierda (opcional)', type: 'url', default: '', section: 'content' },
                { name: 'leftImagePosition', label: 'Posici√≥n imagen izquierda', type: 'select', options: ['arriba', 'abajo'], default: 'arriba', section: 'design' },
                { name: 'leftContent', label: 'Contenido texto izquierda', type: 'textarea', default: 'Contenido columna izquierda', section: 'content' },
                
                { name: 'rightTitle', label: 'T√≠tulo columna derecha', type: 'text', default: '', section: 'content' },
                { name: 'rightTitleSize', label: 'Tama√±o t√≠tulo derecha (px)', type: 'number', default: '20', section: 'design' },
                { name: 'rightShowImage', label: 'Mostrar imagen derecha', type: 'checkbox', default: false, section: 'content' },
                { name: 'rightImageUrl', label: 'URL imagen derecha', type: 'url', default: 'https://via.placeholder.com/300x200?text=IMAGEN', section: 'content' },
                { name: 'rightImageAlt', label: 'Texto alt imagen derecha', type: 'text', default: 'Imagen derecha', section: 'content' },
                { name: 'rightImageLink', label: 'Enlace imagen derecha (opcional)', type: 'url', default: '', section: 'content' },
                { name: 'rightImagePosition', label: 'Posici√≥n imagen derecha', type: 'select', options: ['arriba', 'abajo'], default: 'arriba', section: 'design' },
                { name: 'rightContent', label: 'Contenido texto derecha', type: 'textarea', default: 'Contenido columna derecha', section: 'content' },
                
                { name: 'titleColor', label: 'Color de los t√≠tulos', type: 'color', default: '#202020', section: 'design' },
                { name: 'textColor', label: 'Color del texto', type: 'color', default: '#202020', section: 'design' },
                { name: 'bgColor', label: 'Color de fondo', type: 'color', default: '#ffffff', section: 'design' },
                { name: 'fontSize', label: 'Tama√±o de texto (px)', type: 'number', default: '16', section: 'design' }
            ]),
            'cta-section': addCommonFields([
                { name: 'title', label: 'T√≠tulo', type: 'text', default: '¬°No te pierdas esto!', section: 'content' },
                { name: 'subtitle', label: 'Subt√≠tulo', type: 'text', default: 'Fecha y lugar del evento', section: 'content' },
                { name: 'buttonText', label: 'Texto del Bot√≥n', type: 'text', default: 'HACER CLIC', section: 'content' },
                { name: 'buttonUrl', label: 'URL', type: 'url', default: 'https://ejemplo.com', section: 'content' },
                { name: 'titleColor', label: 'Color del t√≠tulo', type: 'color', default: '#202020', section: 'design' },
                { name: 'subtitleColor', label: 'Color del subt√≠tulo', type: 'color', default: '#696969', section: 'design' },
                { name: 'buttonBgColor', label: 'Color de fondo del bot√≥n', type: 'color', default: '#ffeb3b', section: 'design' },
                { name: 'buttonTextColor', label: 'Color de texto del bot√≥n', type: 'color', default: '#000000', section: 'design' },
                { name: 'bgColor', label: 'Color de fondo', type: 'color', default: '#f8f8f8', section: 'design' },
                { name: 'titleFontSize', label: 'Tama√±o t√≠tulo (px)', type: 'number', default: '24', section: 'design' },
                { name: 'subtitleFontSize', label: 'Tama√±o subt√≠tulo (px)', type: 'number', default: '16', section: 'design' },
                { name: 'buttonFontSize', label: 'Tama√±o texto bot√≥n (px)', type: 'number', default: '16', section: 'design' },
                // Nuevas opciones del bot√≥n
                { name: 'buttonBorderRadius', label: 'Radio del borde bot√≥n (px)', type: 'number', default: '3', section: 'design' },
                { name: 'buttonBorderWidth', label: 'Ancho del borde (px)', type: 'number', default: '0', section: 'design' },
                { name: 'buttonBorderColor', label: 'Color del borde', type: 'color', default: '#000000', section: 'design' },
                { name: 'buttonPaddingVertical', label: 'Padding vertical bot√≥n (px)', type: 'number', default: '20', section: 'design' },
                { name: 'buttonPaddingHorizontal', label: 'Padding horizontal bot√≥n (px)', type: 'number', default: '40', section: 'design' },
                { name: 'buttonFontWeight', label: 'Peso fuente bot√≥n', type: 'select', options: ['normal', 'bold', '300', '400', '600', '700'], default: 'bold', section: 'design' },
                { name: 'buttonTextTransform', label: 'Transformaci√≥n texto', type: 'select', options: ['none', 'uppercase', 'lowercase', 'capitalize'], default: 'uppercase', section: 'design' },
                { name: 'buttonHoverBgColor', label: 'Color hover fondo (opcional)', type: 'color', default: '', section: 'design' },
                { name: 'buttonWidth', label: 'Ancho del bot√≥n', type: 'select', options: ['auto', '100%', '200px', '250px', '300px'], default: 'auto', section: 'design' }
            ]),
            'info-practica': addCommonFields([
                { name: 'title', label: 'T√≠tulo', type: 'text', default: 'INFO PR√ÅCTICA', section: 'content' },
                { name: 'address', label: 'Direcci√≥n', type: 'text', default: 'Tu direcci√≥n completa aqu√≠', section: 'content' },
                { name: 'schedule', label: 'Horarios', type: 'textarea', default: 'Turno ma√±ana: 00:00 a 00:00\nTurno tarde: 00:00 a 00:00', section: 'content' },
                { name: 'transport', label: 'Transporte', type: 'textarea', default: 'Metro: [Estaci√≥n]\nBus: [L√≠neas]', section: 'content' },
                { name: 'titleColor', label: 'Color del t√≠tulo', type: 'color', default: '#000000', section: 'design' },
                { name: 'textColor', label: 'Color del texto', type: 'color', default: '#000000', section: 'design' },
                { name: 'bgColor', label: 'Color de fondo', type: 'color', default: '#ffffff', section: 'design' },
                { name: 'titleFontSize', label: 'Tama√±o t√≠tulo (px)', type: 'number', default: '28', section: 'design' },
                { name: 'fontSize', label: 'Tama√±o de texto (px)', type: 'number', default: '16', section: 'design' }
            ]),
            'footer-advanced': addCommonFields([
                { name: 'email', label: 'Email', type: 'email', default: 'info@ejemplo.com', section: 'content' },
                { name: 'phone', label: 'Tel√©fono', type: 'tel', default: '+34 123 456 789', section: 'content' },
                { name: 'fbUrl', label: 'URL de Facebook', type: 'url', default: '#', section: 'content' },
                { name: 'igUrl', label: 'URL de Instagram', type: 'url', default: '#', section: 'content' },
                { name: 'companyName', label: 'Nombre de la empresa', type: 'text', default: 'Mi Empresa', section: 'content' },
                { name: 'year', label: 'A√±o', type: 'number', default: '2025', section: 'content' },
                { name: 'bgColor', label: 'Color de fondo', type: 'color', default: '#000000', section: 'design' },
                { name: 'textColor', label: 'Color del texto', type: 'color', default: '#ffffff', section: 'design' },
                { name: 'fontSize', label: 'Tama√±o de texto (px)', type: 'number', default: '14', section: 'design' }
            ]),
            'divider': [
                { name: 'color', label: 'Color', type: 'color', default: '#EAEAEA', section: 'design' },
                { name: 'thickness', label: 'Grosor (px)', type: 'number', default: '2', section: 'design' },
                { name: 'bgColor', label: 'Color de fondo', type: 'color', default: '#ffffff', section: 'design' },
                { name: 'paddingTop', label: 'Padding superior (px)', type: 'number', default: '30', section: 'spacing' },
                { name: 'paddingBottom', label: 'Padding inferior (px)', type: 'number', default: '30', section: 'spacing' },
                { name: 'paddingLeft', label: 'Padding izquierdo (px)', type: 'number', default: '30', section: 'spacing' },
                { name: 'paddingRight', label: 'Padding derecho (px)', type: 'number', default: '30', section: 'spacing' }
            ],
            'event-details': addCommonFields([
                { name: 'title', label: 'T√≠tulo del evento', type: 'text', default: 'PR√ìXIMO EVENTO', section: 'content' },
                { name: 'date', label: 'Fecha', type: 'text', default: '15 de Agosto, 2025', section: 'content' },
                { name: 'location', label: 'Ubicaci√≥n', type: 'text', default: 'Barcelona, Espa√±a', section: 'content' },
                { name: 'description', label: 'Descripci√≥n', type: 'textarea', default: 'Descripci√≥n del evento...', section: 'content' },
                { name: 'imageUrl', label: 'URL de imagen', type: 'url', default: 'https://via.placeholder.com/600x300?text=EVENTO', section: 'content' },
                { name: 'titleColor', label: 'Color del t√≠tulo', type: 'color', default: '#202020', section: 'design' },
                { name: 'textColor', label: 'Color del texto', type: 'color', default: '#202020', section: 'design' },
                { name: 'bgColor', label: 'Color de fondo', type: 'color', default: '#ffffff', section: 'design' },
                { name: 'titleFontSize', label: 'Tama√±o t√≠tulo (px)', type: 'number', default: '28', section: 'design' },
                { name: 'fontSize', label: 'Tama√±o de texto (px)', type: 'number', default: '18', section: 'design' }
            ]),
            'social-media': addCommonFields([
                { name: 'title', label: 'T√≠tulo', type: 'text', default: 'S√çGUENOS', section: 'content' },
                { name: 'fbUrl', label: 'URL de Facebook', type: 'url', default: '#', section: 'content' },
                { name: 'igUrl', label: 'URL de Instagram', type: 'url', default: '#', section: 'content' },
                { name: 'twUrl', label: 'URL de Twitter', type: 'url', default: '#', section: 'content' },
                { name: 'ytUrl', label: 'URL de YouTube', type: 'url', default: '#', section: 'content' },
                { name: 'titleColor', label: 'Color del t√≠tulo', type: 'color', default: '#202020', section: 'design' },
                { name: 'bgColor', label: 'Color de fondo', type: 'color', default: '#ffffff', section: 'design' },
                { name: 'titleFontSize', label: 'Tama√±o t√≠tulo (px)', type: 'number', default: '24', section: 'design' }
            ])
        };

        // Plantillas de HTML para cada tipo de elemento
        const elementTemplates = {
            'preheader': (config) => `
                <div style="padding: ${config.paddingTop || 15}px ${config.paddingRight || 20}px ${config.paddingBottom || 15}px ${config.paddingLeft || 20}px; text-align: center; font-size: ${config.fontSize || 12}px; color: ${config.textColor}; background-color: ${config.bgColor}; border-bottom: 1px solid #eaeaea; font-family: ${config.fontFamily || 'Helvetica Neue'}, Helvetica, Arial, sans-serif; line-height: ${config.lineHeight || '1.6'}; letter-spacing: ${config.letterSpacing || '0'}px;">
                    ${config.previewText} ‚Äî <a href="#" style="color: ${config.textColor}; text-decoration: underline;">${config.linkText}</a>
                </div>
            `,
            'header': (config) => {
                let textAlign = 'center';
                if (config.logoAlignment === 'izquierda') textAlign = 'left';
                if (config.logoAlignment === 'derecha') textAlign = 'right';
                
                return `
                <div style="background-color: ${config.bgColor}; padding: ${config.paddingTop || 30}px ${config.paddingRight || 20}px ${config.paddingBottom || 30}px ${config.paddingLeft || 20}px; text-align: ${textAlign}; font-family: ${config.fontFamily || 'Helvetica Neue'}, Helvetica, Arial, sans-serif;">
                    <img src="${config.logoUrl}" alt="Logo" style="width: ${config.logoWidth}; height: ${config.logoHeight}; margin-bottom: 25px;">
                </div>
                `;
            },
            'banner-main': (config) => `
                <div style="padding: ${config.paddingTop || 20}px ${config.paddingRight || 30}px ${config.paddingBottom || 20}px ${config.paddingLeft || 30}px; background-color: ${config.bgColor}; text-align: center; font-family: ${config.fontFamily || 'Helvetica Neue'}, Helvetica, Arial, sans-serif;">
                    ${config.linkUrl ? `<a href="${config.linkUrl}" target="_blank">` : ''}
                    <img src="${config.imageUrl}" alt="${config.altText}" style="max-width: 100%; height: auto; border-radius: 3px;">
                    ${config.linkUrl ? '</a>' : ''}
                </div>
            `,
            'title-intro': (config) => `
                <div style="padding: ${config.paddingTop || 20}px ${config.paddingRight || 30}px ${config.paddingBottom || 20}px ${config.paddingLeft || 30}px; background-color: ${config.bgColor}; font-family: ${config.fontFamily || 'Helvetica Neue'}, Helvetica, Arial, sans-serif; line-height: ${config.lineHeight || '1.6'}; letter-spacing: ${config.letterSpacing || '0'}px;">
                    <h1 style="font-size: ${config.titleFontSize || 26}px; font-weight: ${config.titleFontWeight || 'bold'}; color: ${config.titleColor}; text-align: center; margin-bottom: 20px; margin-top: 0;">${config.title}</h1>
                    <div style="font-size: ${config.fontSize}px; line-height: ${config.lineHeight || '1.6'}; color: ${config.textColor}; letter-spacing: ${config.letterSpacing || '0'}px;">${config.content.replace(/\n/g, '<br>')}</div>
                </div>
            `,
            'divider': (config) => `
                <div style="padding: ${config.paddingTop || 30}px ${config.paddingRight || 30}px ${config.paddingBottom || 30}px ${config.paddingLeft || 30}px; background-color: ${config.bgColor};">
                    <hr style="border: none; border-top: ${config.thickness}px solid ${config.color}; margin: 0;">
                </div>
            `,
            'section-title': (config) => `
                <div style="padding: ${config.paddingTop || 20}px ${config.paddingRight || 30}px ${config.paddingBottom || 20}px ${config.paddingLeft || 30}px; background-color: ${config.bgColor}; font-family: ${config.fontFamily || 'Helvetica Neue'}, Helvetica, Arial, sans-serif; line-height: ${config.lineHeight || '1.6'}; letter-spacing: ${config.letterSpacing || '0'}px;">
                    <h2 style="font-size: ${config.fontSize}px; font-weight: ${config.fontWeight || 'bold'}; color: ${config.titleColor}; margin: 0; text-align: ${config.textAlign || 'left'}; letter-spacing: ${config.letterSpacing || '0'}px;">${config.title}</h2>
                </div>
            `,
            'text-content': (config) => `
                <div style="padding: ${config.paddingTop || 20}px ${config.paddingRight || 30}px ${config.paddingBottom || 20}px ${config.paddingLeft || 30}px; background-color: ${config.bgColor}; font-family: ${config.fontFamily || 'Helvetica Neue'}, Helvetica, Arial, sans-serif; line-height: ${config.lineHeight || '1.6'}; letter-spacing: ${config.letterSpacing || '0'}px;">
                    <div style="font-size: ${config.fontSize}px; line-height: ${config.lineHeight || '1.6'}; color: ${config.textColor}; text-align: ${config.textAlign || 'left'}; letter-spacing: ${config.letterSpacing || '0'}px;">${config.content.replace(/\n/g, '<br>')}</div>
                </div>
            `,
            'three-photos': (config) => `
                <div style="padding: ${config.paddingTop || 20}px ${config.paddingRight || 30}px ${config.paddingBottom || 20}px ${config.paddingLeft || 30}px; background-color: ${config.bgColor}; font-family: ${config.fontFamily || 'Helvetica Neue'}, Helvetica, Arial, sans-serif; line-height: ${config.lineHeight || '1.6'}; letter-spacing: ${config.letterSpacing || '0'}px;">
                    <table width="100%" cellpadding="0" cellspacing="0" border="0">
                        <tr>
                            <td style="width: 33.33%; text-align: center; padding: 5px;">
                                ${config.image1Link ? `<a href="${config.image1Link}" target="_blank">` : ''}
                                <img src="${config.image1Url}" alt="Imagen 1" style="width: 100%; height: auto; border-radius: 3px; margin-bottom: 10px;">
                                ${config.image1Link ? '</a>' : ''}
                                <p style="font-size: ${config.fontSize}px; font-weight: bold; color: ${config.textColor}; margin: 0; letter-spacing: ${config.letterSpacing || '0'}px;">${config.image1Text}</p>
                            </td>
                            <td style="width: 33.33%; text-align: center; padding: 5px;">
                                ${config.image2Link ? `<a href="${config.image2Link}" target="_blank">` : ''}
                                <img src="${config.image2Url}" alt="Imagen 2" style="width: 100%; height: auto; border-radius: 3px; margin-bottom: 10px;">
                                ${config.image2Link ? '</a>' : ''}
                                <p style="font-size: ${config.fontSize}px; font-weight: bold; color: ${config.textColor}; margin: 0; letter-spacing: ${config.letterSpacing || '0'}px;">${config.image2Text}</p>
                            </td>
                            <td style="width: 33.33%; text-align: center; padding: 5px;">
                                ${config.image3Link ? `<a href="${config.image3Link}" target="_blank">` : ''}
                                <img src="${config.image3Url}" alt="Imagen 3" style="width: 100%; height: auto; border-radius: 3px; margin-bottom: 10px;">
                                ${config.image3Link ? '</a>' : ''}
                                <p style="font-size: ${config.fontSize}px; font-weight: bold; color: ${config.textColor}; margin: 0; letter-spacing: ${config.letterSpacing || '0'}px;">${config.image3Text}</p>
                            </td>
                        </tr>
                    </table>
                </div>
            `,
            'two-columns': (config) => `
                <div style="padding: ${config.paddingTop || 20}px ${config.paddingRight || 30}px ${config.paddingBottom || 20}px ${config.paddingLeft || 30}px; background-color: ${config.bgColor}; font-family: ${config.fontFamily || 'Helvetica Neue'}, Helvetica, Arial, sans-serif; line-height: ${config.lineHeight || '1.6'}; letter-spacing: ${config.letterSpacing || '0'}px;">
                    <table width="100%" cellpadding="0" cellspacing="0" border="0">
                        <tr>
                            <td style="width: 50%; padding: 10px; vertical-align: top;">
                                ${config.leftTitle ? 
                                    `<h3 style="font-size: ${config.leftTitleSize}px; margin-top: 0; margin-bottom: 15px; color: ${config.titleColor}; font-weight: bold; letter-spacing: ${config.letterSpacing || '0'}px;">${config.leftTitle}</h3>` : ''
                                }
                                
                                ${config.leftShowImage && config.leftImagePosition === 'arriba' ? 
                                    `${config.leftImageLink ? `<a href="${config.leftImageLink}" target="_blank">` : ''}
                                     <img src="${config.leftImageUrl}" alt="${config.leftImageAlt}" style="width: 100%; height: auto; border-radius: 3px; margin-bottom: 15px;">
                                     ${config.leftImageLink ? '</a>' : ''}` : ''
                                }
                                
                                <div style="font-size: ${config.fontSize}px; line-height: ${config.lineHeight || '1.6'}; color: ${config.textColor}; margin-bottom: ${config.leftShowImage && config.leftImagePosition === 'abajo' ? '15px' : '0'}; letter-spacing: ${config.letterSpacing || '0'}px;">
                                    ${config.leftContent.replace(/\n/g, '<br>')}
                                </div>
                                
                                ${config.leftShowImage && config.leftImagePosition === 'abajo' ? 
                                    `${config.leftImageLink ? `<a href="${config.leftImageLink}" target="_blank">` : ''}
                                     <img src="${config.leftImageUrl}" alt="${config.leftImageAlt}" style="width: 100%; height: auto; border-radius: 3px; margin-top: 15px;">
                                     ${config.leftImageLink ? '</a>' : ''}` : ''
                                }
                            </td>
                            <td style="width: 50%; padding: 10px; vertical-align: top;">
                                ${config.rightTitle ? 
                                    `<h3 style="font-size: ${config.rightTitleSize}px; margin-top: 0; margin-bottom: 15px; color: ${config.titleColor}; font-weight: bold; letter-spacing: ${config.letterSpacing || '0'}px;">${config.rightTitle}</h3>` : ''
                                }
                                
                                ${config.rightShowImage && config.rightImagePosition === 'arriba' ? 
                                    `${config.rightImageLink ? `<a href="${config.rightImageLink}" target="_blank">` : ''}
                                     <img src="${config.rightImageUrl}" alt="${config.rightImageAlt}" style="width: 100%; height: auto; border-radius: 3px; margin-bottom: 15px;">
                                     ${config.rightImageLink ? '</a>' : ''}` : ''
                                }
                                
                                <div style="font-size: ${config.fontSize}px; line-height: ${config.lineHeight || '1.6'}; color: ${config.textColor}; margin-bottom: ${config.rightShowImage && config.rightImagePosition === 'abajo' ? '15px' : '0'}; letter-spacing: ${config.letterSpacing || '0'}px;">
                                    ${config.rightContent.replace(/\n/g, '<br>')}
                                </div>
                                
                                ${config.rightShowImage && config.rightImagePosition === 'abajo' ? 
                                    `${config.rightImageLink ? `<a href="${config.rightImageLink}" target="_blank">` : ''}
                                     <img src="${config.rightImageUrl}" alt="${config.rightImageAlt}" style="width: 100%; height: auto; border-radius: 3px; margin-top: 15px;">
                                     ${config.rightImageLink ? '</a>' : ''}` : ''
                                }
                            </td>
                        </tr>
                    </table>
                </div>
            `,
            'cta-section': (config) => {
                // Generar estilos del bot√≥n
                const buttonBorder = config.buttonBorderWidth && config.buttonBorderWidth > 0 
                    ? `border: ${config.buttonBorderWidth}px solid ${config.buttonBorderColor};` 
                    : 'border: none;';
                
                const buttonWidth = config.buttonWidth === 'auto' 
                    ? 'display: inline-block;' 
                    : `display: block; width: ${config.buttonWidth}; margin: 0 auto;`;
                
                const hoverStyles = config.buttonHoverBgColor 
                    ? `<style>
                        .cta-button-${Math.random().toString(36).substr(2, 9)}:hover {
                            background-color: ${config.buttonHoverBgColor} !important;
                        }
                      </style>` 
                    : '';
                
                return `
                    ${hoverStyles}
                    <div style="background: ${config.bgColor}; padding: ${config.paddingTop || 30}px ${config.paddingRight || 30}px ${config.paddingBottom || 30}px ${config.paddingLeft || 30}px; text-align: center; font-family: ${config.fontFamily || 'Helvetica Neue'}, Helvetica, Arial, sans-serif; line-height: ${config.lineHeight || '1.6'}; letter-spacing: ${config.letterSpacing || '0'}px;">
                        <div style="font-size: ${config.titleFontSize || 24}px; font-weight: bold; color: ${config.titleColor}; margin-bottom: 10px; letter-spacing: ${config.letterSpacing || '0'}px;">${config.title}</div>
                        <div style="font-size: ${config.subtitleFontSize || 16}px; color: ${config.subtitleColor}; margin-bottom: 20px; letter-spacing: ${config.letterSpacing || '0'}px;">${config.subtitle}</div>
                        <a href="${config.buttonUrl}" style="${buttonWidth} background-color: ${config.buttonBgColor}; color: ${config.buttonTextColor}; text-decoration: none; font-weight: ${config.buttonFontWeight || 'bold'}; padding: ${config.buttonPaddingVertical || 20}px ${config.buttonPaddingHorizontal || 40}px; border-radius: ${config.buttonBorderRadius || 3}px; text-transform: ${config.buttonTextTransform || 'uppercase'}; font-size: ${config.buttonFontSize || 16}px; letter-spacing: ${config.letterSpacing || '0'}px; ${buttonBorder} transition: all 0.3s ease;">${config.buttonText}</a>
                    </div>
                `;
            },
            'info-practica': (config) => `
                <div style="background-color: ${config.bgColor}; padding: ${config.paddingTop || 40}px ${config.paddingRight || 30}px ${config.paddingBottom || 40}px ${config.paddingLeft || 30}px; font-family: ${config.fontFamily || 'Helvetica Neue'}, Helvetica, Arial, sans-serif; line-height: ${config.lineHeight || '1.6'}; letter-spacing: ${config.letterSpacing || '0'}px;">
                    <h2 style="font-size: ${config.titleFontSize || 28}px; font-weight: bold; color: ${config.titleColor}; margin-bottom: 30px; text-align: center; margin-top: 0; letter-spacing: ${config.letterSpacing || '0'}px;">${config.title}</h2>
                    <div style="font-size: ${config.fontSize}px; line-height: ${config.lineHeight || '1.6'}; color: ${config.textColor}; letter-spacing: ${config.letterSpacing || '0'}px;">
                        <strong>Direcci√≥n:</strong> ${config.address}<br><br>
                        <strong>Horarios:</strong> ${config.schedule.replace(/\n/g, '<br>')}<br><br>
                        <strong>Transporte:</strong> ${config.transport.replace(/\n/g, '<br>')}
                    </div>
                </div>
            `,
            'footer-advanced': (config) => `
                <div style="background-color: ${config.bgColor}; color: ${config.textColor}; padding: ${config.paddingTop || 40}px ${config.paddingRight || 20}px ${config.paddingBottom || 40}px ${config.paddingLeft || 20}px; text-align: center; font-family: ${config.fontFamily || 'Helvetica Neue'}, Helvetica, Arial, sans-serif; line-height: ${config.lineHeight || '1.6'}; letter-spacing: ${config.letterSpacing || '0'}px;">
                    <div style="margin-bottom: 30px;">
                        <h3 style="color: ${config.textColor}; font-size: 16px; margin-bottom: 15px; margin-top: 0; letter-spacing: ${config.letterSpacing || '0'}px;">CONTACTO</h3>
                        <div style="font-size: ${config.fontSize}px; line-height: ${config.lineHeight || '1.6'}; letter-spacing: ${config.letterSpacing || '0'}px;">
                            Email: ${config.email}<br>
                            Tel√©fono: ${config.phone}
                        </div>
                    </div>
                    <div style="margin-bottom: 30px;">
                        <a href="${config.fbUrl}" style="margin: 0 10px;"><img src="https://cdn-images.mailchimp.com/icons/social-block-v2/color-facebook-48.png" alt="Facebook" style="width: 32px; height: 32px;"></a>
                        <a href="${config.igUrl}" style="margin: 0 10px;"><img src="https://cdn-images.mailchimp.com/icons/social-block-v2/color-instagram-48.png" alt="Instagram" style="width: 32px; height: 32px;"></a>
                    </div>
                    <div style="font-size: 12px; color: #999999; letter-spacing: ${config.letterSpacing || '0'}px;">
                        ¬© ${config.year} ${config.companyName}. Todos los derechos reservados.
                    </div>
                </div>
            `,
            'event-details': (config) => `
                <div style="padding: ${config.paddingTop || 30}px ${config.paddingRight || 30}px ${config.paddingBottom || 30}px ${config.paddingLeft || 30}px; background-color: ${config.bgColor}; font-family: ${config.fontFamily || 'Helvetica Neue'}, Helvetica, Arial, sans-serif; line-height: ${config.lineHeight || '1.6'}; letter-spacing: ${config.letterSpacing || '0'}px;">
                    <h2 style="font-size: ${config.titleFontSize || 28}px; font-weight: bold; color: ${config.titleColor}; margin-bottom: 20px; text-align: center; margin-top: 0; letter-spacing: ${config.letterSpacing || '0'}px;">${config.title}</h2>
                    <img src="${config.imageUrl}" alt="Evento" style="width: 100%; height: auto; border-radius: 3px; margin-bottom: 20px;">
                    <div style="font-size: ${config.fontSize}px; line-height: ${config.lineHeight || '1.6'}; color: ${config.textColor}; letter-spacing: ${config.letterSpacing || '0'}px;">
                        <p style="margin-bottom: 10px; margin-top: 0;"><strong>Fecha:</strong> ${config.date}</p>
                        <p style="margin-bottom: 10px; margin-top: 0;"><strong>Ubicaci√≥n:</strong> ${config.location}</p>
                        <p style="margin-top: 0;">${config.description.replace(/\n/g, '<br>')}</p>
                    </div>
                </div>
            `,
            'social-media': (config) => `
                <div style="padding: ${config.paddingTop || 30}px ${config.paddingRight || 30}px ${config.paddingBottom || 30}px ${config.paddingLeft || 30}px; background-color: ${config.bgColor}; text-align: center; font-family: ${config.fontFamily || 'Helvetica Neue'}, Helvetica, Arial, sans-serif; line-height: ${config.lineHeight || '1.6'}; letter-spacing: ${config.letterSpacing || '0'}px;">
                    <h3 style="color: ${config.titleColor}; font-size: ${config.titleFontSize || 24}px; margin-bottom: 20px; margin-top: 0; letter-spacing: ${config.letterSpacing || '0'}px;">${config.title}</h3>
                    <div style="display: flex; justify-content: center; gap: 15px; flex-wrap: wrap;">
                        <a href="${config.fbUrl}" target="_blank"><img src="https://cdn-images.mailchimp.com/icons/social-block-v2/color-facebook-48.png" alt="Facebook" style="width: 40px; height: 40px;"></a>
                        <a href="${config.igUrl}" target="_blank"><img src="https://cdn-images.mailchimp.com/icons/social-block-v2/color-instagram-48.png" alt="Instagram" style="width: 40px; height: 40px;"></a>
                        <a href="${config.twUrl}" target="_blank"><img src="https://cdn-images.mailchimp.com/icons/social-block-v2/color-twitter-48.png" alt="Twitter" style="width: 40px; height: 40px;"></a>
                        <a href="${config.ytUrl}" target="_blank"><img src="https://cdn-images.mailchimp.com/icons/social-block-v2/color-youtube-48.png" alt="YouTube" style="width: 40px; height: 40px;"></a>
                    </div>
                </div>
            `
        };

        // Funciones principales
        function initDragAndDrop() {
            console.log('Inicializando drag and drop...');
            
            // Hacer elementos arrastrables
            document.querySelectorAll('.element').forEach(element => {
                element.draggable = true;
                element.addEventListener('dragstart', handleDragStart);
                element.addEventListener('dragend', handleDragEnd);
            });

            // Eventos de drop para toda el √°rea de canvas
            const canvas = document.querySelector('.email-preview');
            if (canvas) {
                canvas.addEventListener('dragover', handleDragOver);
                canvas.addEventListener('drop', handleDrop);
                canvas.addEventListener('dragenter', handleDragEnter);
                canvas.addEventListener('dragleave', handleDragLeave);
            }

            // Evento de selecci√≥n
            document.addEventListener('click', handleElementSelect);
            
            console.log('Drag and drop inicializado');
        }

        function handleDragEnd(e) {
            e.target.style.opacity = '1';
            document.querySelectorAll('.drag-over').forEach(zone => {
                zone.classList.remove('drag-over');
            });
        }

        function handleDragEnter(e) {
            e.preventDefault();
        }

        function handleDragLeave(e) {
            // Solo remover drag-over si realmente salimos del elemento
            const dropZone = e.target.closest('[data-drop="true"]');
            if (dropZone && !dropZone.contains(e.relatedTarget)) {
                dropZone.classList.remove('drag-over');
            }
        }

        function handleDragStart(e) {
            console.log('Drag start:', e.target.dataset.element);
            draggedElement = e.target.dataset.element;
            e.dataTransfer.effectAllowed = 'copy';
            e.target.style.opacity = '0.5';
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'copy';
            
            const dropZone = e.target.closest('[data-drop="true"]');
            if (dropZone) {
                dropZone.classList.add('drag-over');
            }
        }

        function handleDrop(e) {
            e.preventDefault();
            console.log('Drop event:', draggedElement);
            
            // Limpiar efectos visuales
            document.querySelectorAll('.drag-over').forEach(zone => {
                zone.classList.remove('drag-over');
            });
            
            document.querySelectorAll('.element').forEach(el => {
                el.style.opacity = '1';
            });
            
            const dropZone = e.target.closest('[data-drop="true"]');
            if (dropZone && draggedElement) {
                console.log('A√±adiendo elemento:', draggedElement);
                addElement(draggedElement, dropZone);
            }
        }

        function handleElementSelect(e) {
            // Limpiar selecci√≥n anterior
            document.querySelectorAll('.editable-element').forEach(el => {
                el.classList.remove('selected');
            });

            // Seleccionar nuevo elemento
            const editableElement = e.target.closest('.editable-element');
            if (editableElement) {
                editableElement.classList.add('selected');
                selectedElement = editableElement;
                e.stopPropagation();
            }
        }

        function addElement(elementType, dropZone) {
            console.log('A√±adiendo elemento:', elementType);
            
            // Obtener configuraci√≥n por defecto
            const config = getDefaultConfig(elementType);
            
            // Crear el elemento
            const elementHTML = elementTemplates[elementType](config);
            
            // Crear wrapper
            const wrapper = document.createElement('div');
            wrapper.className = 'editable-element';
            wrapper.dataset.element = elementType;
            wrapper.dataset.config = JSON.stringify(config);
            wrapper.innerHTML = elementHTML + `
                <div class="element-controls">
                    <button class="control-btn" onclick="editElement(this)" title="Editar">‚úèÔ∏è</button>
                    <button class="control-btn" onclick="moveUp(this)" title="Mover arriba">‚¨ÜÔ∏è</button>
                    <button class="control-btn" onclick="moveDown(this)" title="Mover abajo">‚¨áÔ∏è</button>
                    <button class="control-btn" onclick="deleteElement(this)" title="Eliminar">üóëÔ∏è</button>
                </div>
            `;
            
            // Reemplazar drop zone
            dropZone.parentNode.replaceChild(wrapper, dropZone);
            
            // Agregar nueva drop zone
            const newDropZone = document.createElement('div');
            newDropZone.className = 'drop-zone';
            newDropZone.setAttribute('data-drop', 'true');
            newDropZone.textContent = 'Arrastra m√°s elementos aqu√≠';
            wrapper.parentNode.insertBefore(newDropZone, wrapper.nextSibling);
            
            console.log('Elemento a√±adido correctamente');
        }

        function getDefaultConfig(elementType) {
            const config = {};
            const fields = elementConfigs[elementType] || [];
            
            fields.forEach(field => {
                config[field.name] = field.default;
            });
            
            return config;
        }

        function editElement(button) {
            console.log('Editando elemento');
            const element = button.closest('.editable-element');
            const elementType = element.dataset.element;
            const currentConfig = JSON.parse(element.dataset.config || '{}');
            
            openConfigModal(elementType, currentConfig, element);
        }

        function moveUp(button) {
            const element = button.closest('.editable-element');
            const prevElement = element.previousElementSibling;
            
            if (prevElement && !prevElement.classList.contains('drop-zone')) {
                element.parentNode.insertBefore(element, prevElement);
            }
        }

        function moveDown(button) {
            const element = button.closest('.editable-element');
            const nextElement = element.nextElementSibling;
            const nextNextElement = nextElement ? nextElement.nextElementSibling : null;
            
            if (nextNextElement) {
                element.parentNode.insertBefore(element, nextNextElement.nextElementSibling);
            }
        }

        function deleteElement(button) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar este elemento?')) {
                const element = button.closest('.editable-element');
                
                const dropZone = document.createElement('div');
                dropZone.className = 'drop-zone';
                dropZone.setAttribute('data-drop', 'true');
                dropZone.textContent = 'Arrastra elementos aqu√≠';
                
                element.parentNode.replaceChild(dropZone, element);
            }
        }

        function openConfigModal(elementType, config, element) {
            const modal = document.getElementById('configModal');
            const fieldsContainer = document.getElementById('configFields');
            const fields = elementConfigs[elementType] || [];
            
            // Activar la primera pesta√±a por defecto
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector('.tab[data-tab="content"]').classList.add('active');
            
            fieldsContainer.innerHTML = '';
            
            if (fields.length === 0) {
                fieldsContainer.innerHTML = '<p>Este elemento no tiene opciones de configuraci√≥n.</p>';
            } else {
                // Crear contenedores de pesta√±as
                const contentTab = document.createElement('div');
                contentTab.className = 'tab-content active';
                contentTab.setAttribute('data-tab-content', 'content');
                
                const designTab = document.createElement('div');
                designTab.className = 'tab-content';
                designTab.setAttribute('data-tab-content', 'design');
                
                const spacingTab = document.createElement('div');
                spacingTab.className = 'tab-content';
                spacingTab.setAttribute('data-tab-content', 'spacing');
                
                // Distribuir campos en pesta√±as
                fields.forEach(field => {
                    const group = document.createElement('div');
                    group.className = 'form-group';
                    
                    const label = document.createElement('label');
                    label.textContent = field.label;
                    group.appendChild(label);
                    
                    if (field.type === 'textarea') {
                        const input = document.createElement('textarea');
                        input.name = field.name;
                        input.value = config[field.name] || field.default;
                        group.appendChild(input);
                    } else if (field.type === 'color') {
                        const colorContainer = document.createElement('div');
                        colorContainer.className = 'color-picker';
                        
                        const colorPreview = document.createElement('div');
                        colorPreview.className = 'color-preview';
                        colorPreview.style.backgroundColor = config[field.name] || field.default;
                        
                        const input = document.createElement('input');
                        input.type = field.type;
                        input.name = field.name;
                        input.value = config[field.name] || field.default;
                        
                        input.addEventListener('input', function() {
                            colorPreview.style.backgroundColor = this.value;
                        });
                        
                        colorContainer.appendChild(colorPreview);
                        colorContainer.appendChild(input);
                        group.appendChild(colorContainer);
                    } else if (field.type === 'select') {
                        const select = document.createElement('select');
                        select.name = field.name;
                        
                        if (field.options) {
                            field.options.forEach(option => {
                                const optionEl = document.createElement('option');
                                optionEl.value = option;
                                optionEl.textContent = option.charAt(0).toUpperCase() + option.slice(1);
                                if (option === (config[field.name] || field.default)) {
                                    optionEl.selected = true;
                                }
                                select.appendChild(optionEl);
                            });
                        }
                        
                        group.appendChild(select);
                    } else if (field.type === 'checkbox') {
                        const checkContainer = document.createElement('div');
                        checkContainer.style.display = 'flex';
                        checkContainer.style.alignItems = 'center';
                        
                        const input = document.createElement('input');
                        input.type = field.type;
                        input.name = field.name;
                        input.checked = config[field.name] || field.default;
                        input.style.width = 'auto';
                        input.style.marginRight = '10px';
                        
                        // Eventos para mostrar/ocultar campos relacionados
                        if (field.name.includes('Show')) {
                            const prefix = field.name.includes('left') ? 'left' : 'right';
                            
                            input.addEventListener('change', function() {
                                const showImage = this.checked;
                                const relatedFields = document.querySelectorAll(`[name^="${prefix}Image"]`);
                                
                                relatedFields.forEach(relField => {
                                    const fieldGroup = relField.closest('.form-group');
                                    fieldGroup.style.display = showImage ? 'block' : 'none';
                                });
                            });
                            
                            // Inicializar visibilidad
                            setTimeout(() => {
                                const showImage = input.checked;
                                const relatedFields = document.querySelectorAll(`[name^="${prefix}Image"]`);
                                
                                relatedFields.forEach(relField => {
                                    const fieldGroup = relField.closest('.form-group');
                                    fieldGroup.style.display = showImage ? 'block' : 'none';
                                });
                            }, 0);
                        }
                        
                        checkContainer.appendChild(input);
                        group.appendChild(checkContainer);
                    } else {
                        const input = document.createElement('input');
                        input.type = field.type;
                        input.name = field.name;
                        input.value = config[field.name] || field.default;
                        
                        // A√±adir atributo step para n√∫meros decimales
                        if (field.step) {
                            input.step = field.step;
                        }
                        
                        group.appendChild(input);
                    }
                    
                    // Asignar a pesta√±a correspondiente seg√∫n la secci√≥n
                    const section = field.section || 'content';
                    if (section === 'design') {
                        designTab.appendChild(group);
                    } else if (section === 'spacing') {
                        spacingTab.appendChild(group);
                    } else {
                        contentTab.appendChild(group);
                    }
                });
                
                // A√±adir pesta√±as al contenedor
                fieldsContainer.appendChild(contentTab);
                fieldsContainer.appendChild(designTab);
                fieldsContainer.appendChild(spacingTab);
                
                // Configurar evento de cambio de pesta√±a
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.addEventListener('click', function() {
                        // Activar pesta√±a
                        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                        this.classList.add('active');
                        
                        // Mostrar contenido de pesta√±a
                        const tabName = this.getAttribute('data-tab');
                        document.querySelectorAll('.tab-content').forEach(content => {
                            content.classList.remove('active');
                        });
                        document.querySelector(`.tab-content[data-tab-content="${tabName}"]`).classList.add('active');
                    });
                });
            }
            
            currentEditingElement = element;
            modal.style.display = 'block';
        }

        function saveElementConfig() {
            const form = document.getElementById('configForm');
            const formData = new FormData(form);
            const config = {};
            
            // Obtener todos los valores incluyendo checkboxes no marcados
            const allInputs = form.querySelectorAll('input, textarea, select');
            allInputs.forEach(input => {
                if (input.type === 'checkbox') {
                    config[input.name] = input.checked;
                } else {
                    config[input.name] = input.value;
                }
            });
            
            const element = currentEditingElement;
            const elementType = element.dataset.element;
            
            element.dataset.config = JSON.stringify(config);
            
            const newHTML = elementTemplates[elementType](config);
            element.innerHTML = newHTML + `
                <div class="element-controls">
                    <button class="control-btn" onclick="editElement(this)" title="Editar">‚úèÔ∏è</button>
                    <button class="control-btn" onclick="moveUp(this)" title="Mover arriba">‚¨ÜÔ∏è</button>
                    <button class="control-btn" onclick="moveDown(this)" title="Mover abajo">‚¨áÔ∏è</button>
                    <button class="control-btn" onclick="deleteElement(this)" title="Eliminar">üóëÔ∏è</button>
                </div>
            `;
            
            closeModal();
        }

        function closeModal() {
            document.getElementById('configModal').style.display = 'none';
            currentEditingElement = null;
        }

        function clearCanvas() {
            if (confirm('¬øEst√°s seguro de que quieres limpiar todo?')) {
                const emailPreview = document.getElementById('emailPreview');
                emailPreview.innerHTML = '<div class="drop-zone" data-drop="true">Arrastra elementos aqu√≠ para construir tu newsletter</div>';
            }
        }

        function previewNewsletter() {
            const emailPreview = document.getElementById('emailPreview');
            const cleanHTML = cleanHTMLForExport(emailPreview.innerHTML);
            const fullHTML = generateFullHTML(cleanHTML);
            
            const previewWindow = window.open('', '_blank', 'width=800,height=600');
            previewWindow.document.write(fullHTML);
            previewWindow.document.close();
        }

        function downloadHTML() {
            const emailPreview = document.getElementById('emailPreview');
            const cleanHTML = cleanHTMLForExport(emailPreview.innerHTML);
            const fullHTML = generateFullHTML(cleanHTML);
            
            const blob = new Blob([fullHTML], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'newsletter-' + new Date().toISOString().slice(0, 10) + '.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function cleanHTMLForExport(html) {
            let cleanHTML = html;
            
            // Remover controles de edici√≥n
            cleanHTML = cleanHTML.replace(/<div class="element-controls">.*?<\/div>/gs, '');
            
            // Remover clases de editor
            cleanHTML = cleanHTML.replace(/class="([^"]*?)(?:editable-element|selected)([^"]*?)"/g, 
                (match, before, after) => {
                    const cleanClass = (before + after).trim().replace(/\s+/g, ' ');
                    return cleanClass ? `class="${cleanClass}"` : '';
                });
            
            // Remover drop zones
            cleanHTML = cleanHTML.replace(/<div[^>]*data-drop[^>]*>.*?<\/div>/gs, '');
            
            // Remover atributos de editor
            cleanHTML = cleanHTML.replace(/\s*data-(element|config|drop)="[^"]*"/g, '');
            
            // Limpiar espacios extra
            cleanHTML = cleanHTML.replace(/\s+/g, ' ').trim();
            
            return cleanHTML;
        }

        function generateFullHTML(bodyContent) {
            return `<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Newsletter</title>
    <link href="https://fonts.googleapis.com/css2?family=Helvetica+Neue:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <style type="text/css">
        /* Reset b√°sico para emails */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body, table, td, p, a, li, blockquote {
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
        }
        
        table {
            border-collapse: collapse !important;
        }
        
        img {
            -ms-interpolation-mode: bicubic;
            border: 0;
            height: auto;
            line-height: 100%;
            outline: none;
            text-decoration: none;
        }

        /* Dark mode styles */
        @media (prefers-color-scheme: dark) {
            .dark-bg { background-color: #1a1a1a !important; }
            .dark-bg-white { background-color: #2d2d2d !important; }
            .dark-text { color: #ffffff !important; }
            .dark-text-gray { color: #b0b0b0 !important; }
            .dark-border { border-color: #404040 !important; }
        }

        /* Mobile responsive */
        @media only screen and (max-width: 600px) {
            .email-container { margin: 5px !important; }
            .content { padding: 20px 15px !important; }
            .header { padding: 15px 10px !important; }
            .three-column { 
                width: 100% !important; 
                display: block !important; 
                margin-bottom: 20px !important; 
            }
            .two-column { 
                width: 100% !important; 
                display: block !important; 
                margin-bottom: 20px !important; 
            }
        }
    </style>
</head>

<body style="margin: 0 !important; padding: 0 !important; width: 100% !important; height: 100% !important; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; background-color: #f4f4f4;">
    <div class="email-container" style="max-width: 650px; margin: 20px auto; background: #ffffff; border-radius: 3px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); overflow: hidden;">
        ${bodyContent}
    </div>
</body>
</html>`;
        }

        // Eventos de teclado
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModal();
            }
            
            if (e.key === 'Delete' && selectedElement) {
                const deleteBtn = selectedElement.querySelector('.control-btn[onclick*="deleteElement"]');
                if (deleteBtn) {
                    deleteElement(deleteBtn);
                }
            }
        });

        // Cerrar modal al hacer click fuera
        document.getElementById('configModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // Limpiar efectos de drag - actualizado
        document.addEventListener('dragend', function(e) {
            e.target.style.opacity = '1';
            document.querySelectorAll('.drag-over').forEach(zone => {
                zone.classList.remove('drag-over');
            });
        });

        // Inicializar cuando el DOM est√© listo y inmediatamente
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initDragAndDrop);
        } else {
            initDragAndDrop();
        }
    </script>
</body>
</html> 
